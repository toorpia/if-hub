# IF-HUB Fetcherモジュールのテスト

このディレクトリにはFetcherモジュールのテストコードが含まれています。

## テスト構成

- **unit**: 単体テスト
  - **formatters**: フォーマッタに関するテスト
  - その他のコンポーネント別テスト
- **integration**: 結合テスト
- **fixtures**: テスト用のデータ
- **mocks**: モックオブジェクト

## テストの実行方法

### 単体テスト

以下のコマンドで単体テストを実行できます：

```bash
# すべての単体テストを実行
npm run test:unit

# 特定のテストファイルのみ実行
npx jest tests/unit/filter.test.ts

# テストカバレッジレポートの生成
npm run test:coverage
```

### 結合テスト

結合テストはIF-HUBサーバーが実行中であることを前提としています。以下のコマンドで実行できます：

```bash
# IF-HUBが稼働していることを確認
./tests/run-integration-tests.sh
```

または：

```bash
npm run test:integration
```

## テストデータについて

テストでは以下のデータを使用しています：

- **Pump01**: ポンプの温度、流量、電力消費データ
  - gtagの例: `Pump01.EfficiencyIndex` (Flow/PowerConsumption × 100)
  - gtagの例: `Pump01.TempMA` (温度の5ポイント移動平均)
- **Tank01**: タンクの液面レベルデータ

## モック

`mocks`ディレクトリには以下のモックが含まれています：

- **api-client.mock.ts**: APIクライアントのモック
  - HTTP通信を実際のAPIに接続せずにシミュレート
  - テストデータに基づいた応答を返す

## カバレッジ目標

このプロジェクトでは以下のテストカバレッジ目標を設定しています：

- ステートメントカバレッジ: 80%以上
- ブランチカバレッジ: 70%以上
- 関数カバレッジ: 90%以上

## テスト戦略

1. **Pure関数のテスト**
   - 入力に対する出力の検証（副作用のないコード）
   - 境界値、特殊ケースのテスト

2. **API操作のテスト**
   - モックを使用したAPIリクエスト/レスポンスのテスト
   - エラーケースの処理

3. **結合テスト**
   - 実際のIF-HUBとの連携テスト
   - コマンドライン引数処理
   - ファイル出力
